---
import type { ImageMetadata } from "astro";
import type { CollectionEntry } from "astro:content";

import { Image } from "astro:assets";

import Label from "../components/Label.astro";

interface Props {
  message: CollectionEntry<"messages">;
  index: number;
}

const { message, index } = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/*.{jpeg,jpg,png,gif}",
);
if (!images[message.data.image.path])
  throw new Error(
    `"${message.data.image.path}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`,
  );
---

<article id={`exhibit-${index}`} class="bg-noise snap-center bg-stone-200">
  <div class="relative flex h-screen w-screen items-center justify-center">
    <figure
      class={`relative z-40 ${message.data.image.properties.isPortrait ? "w-[20vw] aspect-[3/4]" : "w-[30vw] aspect-[4/3]"}`}
    >
      <Image
        src={images[message.data.image.path]()}
        alt={message.data.title}
        densities={[1, 1.5, 2]}
        loading="eager"
        class="box-border"
      />
    </figure>
    <Label {message} />
  </div>
</article>

<style>
  figure:before {
    content: "";
    position: absolute;
    display: block;
    width: 132%;
    height: 132%;
    top: -16%;
    left: -16%;
    background-color: #f8f8f8;
    z-index: -1;
    box-shadow:
      inset 0px 10px 0.5em rgba(0, 0, 0, 0.25),
      inset 0.1em 0px 0.1em rgba(0, 0, 0, 0.1),
      inset -0.1em 0px 0.1em rgba(0, 0, 0, 0.05),
      0 0.3em 0.2em #fff;
    background-image: -moz-radial-gradient(
      circle farthest-corner at 50% 50%,
      #ffffff,
      #f8f8f8 100%
    );
    background-image: -webkit-radial-gradient(
      circle farthest-corner at 50% 50%,
      #ffffff,
      #f8f8f8 100%
    );
    background-image: -o-radial-gradient(
      circle farthest-corner at 50% 50%,
      #ffffff,
      #f8f8f8 100%
    );
    background-image: -ms-radial-gradient(
      circle farthest-corner at 50% 50%,
      #ffffff,
      #f8f8f8 100%
    );
    background-image: radial-gradient(
      circle farthest-corner at 50% 50%,
      #ffffff,
      #f8f8f8 100%
    );
  }

  figure:after {
    content: "";
    position: absolute;
    display: block;
    width: 145%;
    height: 145%;
    top: -22.5%;
    left: -22.5%;
    background: #f8f8f8;
    z-index: -2;
    box-shadow:
      0px 1em 2em -1em rgba(0, 0, 0, 0.4),
      0px 2em 2em -1em rgba(0, 0, 0, 0.3),
      0px 3em 2em -1em rgba(0, 0, 0, 0.2),
      0px 4em 1.5em -1em rgba(0, 0, 0, 0.15),
      0px 2em 4em 0.5em rgba(0, 0, 0, 0.1),
      inset 0 0.2em 0.1em #fff;
  }

  img {
    box-sizing: border-box;
    background: #fff;
    position: relative;
    display: block;
    height: auto;
    padding: 2vw;
    box-shadow: inset 0px 0.3em 0.1em rgba(0, 0, 0, 0.2);
  }
</style>
